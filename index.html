<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kadant India | Service & Visit Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(15, 23, 42, 0.75); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        input, select, textarea { background: #0f172a !important; border: 1px solid #334155 !important; color: white !important; padding: 8px !important; border-radius: 6px !important; width: 100%; font-size: 12px; }
        .table-container { overflow-x: auto; border-radius: 12px; border: 1px solid #1e293b; }
        th { background: #0f172a; color: #94a3b8; font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; padding: 12px; border-bottom: 1px solid #1e293b; }
        td { padding: 12px; font-size: 11px; border-bottom: 1px solid #0f172a; white-space: nowrap; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [user, setUser] = useState(JSON.parse(localStorage.getItem('kadant_auth')) || null);
            const [visits, setVisits] = useState(JSON.parse(localStorage.getItem('k_visits')) || []);
            const [customers, setCustomers] = useState(JSON.parse(localStorage.getItem('k_cust')) || []);

            useEffect(() => {
                localStorage.setItem('k_visits', JSON.stringify(visits));
            }, [visits]);

            if (!user) return <Login onLogin={u => { setUser(u); localStorage.setItem('kadant_auth', JSON.stringify(u)); }} />;

            return (
                <div className="min-h-screen flex flex-col">
                    <nav className="glass border-b border-slate-800 p-4 sticky top-0 z-50">
                        <div className="container mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-cyan-400 font-black text-xl tracking-tighter">KADANT INDIA</h1>
                                <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest leading-none">Service & After-Sales Division</p>
                            </div>
                            <div className="flex gap-4">
                                <button onClick={() => { setUser(null); localStorage.removeItem('kadant_auth'); }} className="text-red-400 text-xs font-bold uppercase">Logout</button>
                            </div>
                        </div>
                    </nav>

                    <main className="p-6 space-y-8 container mx-auto">
                        <VisitEntryForm visits={visits} setVisits={setVisits} customers={customers} />
                        <VisitTable visits={visits} setVisits={setVisits} />
                    </main>
                </div>
            );
        }

        function Login({ onLogin }) {
            const [email, setEmail] = useState('');
            return (
                <div className="h-screen flex items-center justify-center bg-slate-950 p-6">
                    <div className="glass p-10 rounded-3xl w-full max-w-md shadow-2xl text-center">
                        <h2 className="text-2xl font-black text-white mb-6">Service Planner Access</h2>
                        <input type="email" placeholder="email@kadant.com" className="mb-4 text-center" onChange={e => setEmail(e.target.value)} />
                        <button onClick={() => email && onLogin({email})} className="w-full bg-cyan-600 p-4 rounded-xl font-bold uppercase tracking-widest hover:bg-cyan-500 transition-colors">Sign In</button>
                    </div>
                </div>
            );
        }

        function VisitEntryForm({ visits, setVisits, customers }) {
            const [form, setForm] = useState({
                customerCode: '', company: '', country: 'India', place: '', classification: 'A', street: '',
                plan: '', date: '', days: '', remarks: '', opportunities: '', oppValue: '', action: '', 
                status: 'Planned', po: '', orderValue: '', audit: 'No'
            });

            const addVisit = () => {
                if(!form.company || !form.date) return alert("Company and Visit Date required");
                const newVisit = { ...form, slNo: visits.length + 1, id: Date.now() };
                setVisits([...visits, newVisit]);
                setForm({ ...form, company: '', place: '', date: '', oppValue: '', orderValue: '' });
            };

            return (
                <div className="glass p-6 rounded-2xl space-y-6 border-cyan-500/20 shadow-xl">
                    <h3 className="text-lg font-bold text-cyan-400">New Visit Entry</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        <input placeholder="Customer Code" value={form.customerCode} onChange={e => setForm({...form, customerCode: e.target.value})} />
                        <input placeholder="Company Name" value={form.company} onChange={e => setForm({...form, company: e.target.value})} />
                        <input placeholder="Place" value={form.place} onChange={e => setForm({...form, place: e.target.value})} />
                        <select value={form.classification} onChange={e => setForm({...form, classification: e.target.value})}>
                            <option value="A">Class A</option><option value="B">Class B</option><option value="C">Class C</option>
                        </select>
                        <input type="date" value={form.date} onChange={e => setForm({...form, date: e.target.value})} />
                        <input type="number" placeholder="No of Days Travel" value={form.days} onChange={e => setForm({...form, days: e.target.value})} />
                        
                        <input placeholder="Visit Plan/Objective" value={form.plan} onChange={e => setForm({...form, plan: e.target.value})} />
                        <input placeholder="Opportunities" value={form.opportunities} onChange={e => setForm({...form, opportunities: e.target.value})} />
                        <input type="number" placeholder="Value (Euro)" value={form.oppValue} onChange={e => setForm({...form, oppValue: e.target.value})} />
                        <select value={form.status} onChange={e => setForm({...form, status: e.target.value})}>
                            <option>Planned</option><option>Visited</option><option>Won</option><option>Lost</option>
                        </select>
                        <input placeholder="PO Reference" value={form.po} onChange={e => setForm({...form, po: e.target.value})} />
                        <input type="number" placeholder="Order Value" value={form.orderValue} onChange={e => setForm({...form, orderValue: e.target.value})} />
                    </div>
                    <button onClick={addVisit} className="bg-cyan-600 px-8 py-3 rounded-lg font-bold uppercase text-xs tracking-widest hover:bg-cyan-500">Save Visit to Record</button>
                </div>
            );
        }

        function VisitTable({ visits, setVisits }) {
            const exportExcel = () => {
                const ws = XLSX.utils.json_to_sheet(visits);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Visit_Plan");
                XLSX.writeFile(wb, "Kadant_India_Visits.xlsx");
            };

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center">
                        <h3 className="text-lg font-bold">Comprehensive Visit Ledger</h3>
                        <button onClick={exportExcel} className="bg-emerald-600 px-4 py-2 rounded font-bold text-[10px] uppercase">Export to Excel</button>
                    </div>
                    <div className="table-container glass">
                        <table className="w-full text-left">
                            <thead>
                                <tr>
                                    <th>Sl.No</th><th>Customer Code</th><th>Company</th><th>Place</th>
                                    <th>Classification</th><th>Visit Plan</th><th>Visit Date</th><th>Days</th>
                                    <th>Status</th><th>Opp. Value (€)</th><th>Order Value</th><th>Audit Report</th>
                                </tr>
                            </thead>
                            <tbody>
                                {visits.map((v, i) => (
                                    <tr key={v.id} className="hover:bg-slate-800/40">
                                        <td className="text-slate-500 font-mono">{i + 1}</td>
                                        <td className="font-bold text-cyan-400">{v.customerCode}</td>
                                        <td className="font-semibold">{v.company}</td>
                                        <td>{v.place}</td>
                                        <td className="text-center">{v.classification}</td>
                                        <td className="max-w-[150px] truncate">{v.plan}</td>
                                        <td>{v.date}</td>
                                        <td className="text-center">{v.days}</td>
                                        <td><span className={`px-2 py-0.5 rounded text-[9px] font-bold uppercase ${v.status === 'Won' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-slate-800'}`}>{v.status}</span></td>
                                        <td className="text-emerald-400">€{v.oppValue}</td>
                                        <td className="font-bold text-white">€{v.orderValue}</td>
                                        <td>{v.audit}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
